<!-- 
    PROJECT: POLARIS // GUIDANCE LOG 
    AUTHOR: SAJID / ZEP / ALCOR
    STATUS: PEAK AESTHETIC REACHED. COMMS UPDATED. ANIMATIONS ADDED.
    FIX: Implemented robust error handling for API call to prevent "The Void" errors.
    NOTE: If this code looks chaotic, it matches my brain. 
          Gemini helped, but the vibes are 100% manual.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POLARIS // SYSTEM ROOT</title>
    
    <!-- Load Tailwind (The backbone of modern laz... efficiency) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts: IBM Plex Mono is non-negotiable for the retro feel -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons: Lucide (Clean, sharp, vector goodness) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Audio: Tone.js for the UI blips -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.min.js"></script>
    
    <!-- Pet: Oneko.js (The cat is mandatory. Do not remove the cat.) -->
    <script src="https://cdn.jsdelivr.dev/gh/adryd325/oneko.js@main/oneko.js"></script> 

    <style>
        /* --- 1. THEME ENGINE (SEPIA VOID) --- */
        :root {
            --bg-color: #1a1614;       /* Deepest Void Brown */
            --glass-bg: #26201c;       /* Slightly lighter for panels */
            --text-main: #e6dfd5;      /* Off-white paper color */
            --text-muted: #9c9288;     /* Dust grey */
            --accent-color: #dcbfa6;   /* The "Sepia" Glow */
            --accent-dim: #5c4e43;     /* Dimmed accent for borders */
            --error-color: #ff6b6b;    /* Retro Error Red */
            --success-color: #a3d9a5;  /* Retro Success Green */
            
            --scanline-opacity: 0.15;
            --phosphor-glow: 0 0 8px rgba(220, 191, 166, 0.4);
        }

        .light-mode {
            --bg-color: #e6dfd5;
            --glass-bg: #dcbfa6;
            --text-main: #1a1614;
            --text-muted: #5c4e43;
            --accent-color: #1a1614;
            --accent-dim: #9c9288;
            --scanline-opacity: 0.05;
            --phosphor-glow: none;
        }

        /* --- 2. CORE LAYOUT & TYPOGRAPHY --- */
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'IBM Plex Mono', monospace;
            /* SVG Noise Filter for texture */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitch='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            overflow: hidden; /* Main scroll is handled inside the terminal div */
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: color 0.3s, background-color 0.3s;
        }

        /* Custom Scrollbar (Because the default one ruins the immersion) */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { 
            background: var(--accent-dim); 
            border-radius: 2px;
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-color); }

        /* --- 3. RETRO VISUAL EFFECTS & ANIMATIONS --- */
        
        /* The Vignette (Dark corners) */
        body::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.6) 100%);
            pointer-events: none;
            z-index: 90;
        }

        /* The Scanlines & CRT Flicker */
        .scanlines::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            z-index: 91;
            pointer-events: none;
            opacity: var(--scanline-opacity);
            /* ADDED FLICKER ANIMATION */
            animation: flicker 0.15s infinite alternate; 
        }

        /* The Glow (Phosphor Persistence) & Pulse */
        .glow-text {
            text-shadow: var(--phosphor-glow);
            /* ADDED PULSE ANIMATION */
            animation: pulse 4s infinite ease-in-out alternate; 
        }

        /* Distressed Title Effect */
        .glitch-title {
            font-family: 'Inter', sans-serif; /* Contrast font */
            font-weight: 900;
            letter-spacing: -2px;
            filter: url(#distort-text);
            text-transform: uppercase;
        }

        /* Active Glitch Animation for Title */
        .glitch-anim {
            animation: glitch-anim 2s linear infinite alternate;
        }

        /* Links */
        .hover-link {
            border-bottom: 1px dashed var(--accent-dim);
            transition: all 0.2s;
        }
        .hover-link:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
            border-bottom-style: solid;
        }
        
        /* Input Focus Border Animation */
        .input-focus:focus-within {
            box-shadow: 0 0 10px rgba(220, 191, 166, 0.6);
            border-color: var(--accent-color);
            transition: box-shadow 0.3s, border-color 0.3s;
        }

        /* Boot Screen Overlay */
        #boot-screen {
            position: fixed;
            inset: 0;
            background-color: var(--bg-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 2rem;
            font-size: 14px;
            color: var(--accent-color);
        }
        
        .cursor-blink {
            animation: blink 1s step-end infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* KEYFRAMES */
        
        /* Subtle Screen Flicker (For CRT feel) */
        @keyframes flicker {
            0% { opacity: var(--scanline-opacity); }
            5% { opacity: calc(var(--scanline-opacity) + 0.05); }
            10% { opacity: var(--scanline-opacity); }
            25% { opacity: calc(var(--scanline-opacity) - 0.05); }
            100% { opacity: var(--scanline-opacity); }
        }

        /* Breathing Glow Effect */
        @keyframes pulse {
            0% { text-shadow: 0 0 8px rgba(220, 191, 166, 0.4); }
            50% { text-shadow: 0 0 12px rgba(220, 191, 166, 0.6), 0 0 5px rgba(220, 191, 166, 0.2); }
            100% { text-shadow: 0 0 8px rgba(220, 191, 166, 0.4); }
        }

        /* Glitch Animation (For Title) */
        @keyframes glitch-anim {
            0% {
                transform: translate(0);
                text-shadow: 2px 2px 0px rgba(255, 0, 0, 0.5), -2px -2px 0px rgba(0, 0, 255, 0.5);
            }
            20% {
                transform: translate(-5px, 5px);
                text-shadow: -2px 2px 0px rgba(255, 0, 0, 0.5), 2px -2px 0px rgba(0, 255, 0, 0.5);
            }
            40% {
                transform: translate(0);
                text-shadow: 2px -2px 0px rgba(0, 255, 0, 0.5), -2px 2px 0px rgba(255, 0, 0, 0.5);
            }
            60% {
                transform: translate(5px, -5px);
                text-shadow: 2px 2px 0px rgba(0, 0, 255, 0.5), -2px -2px 0px rgba(255, 0, 0, 0.5);
            }
            80% {
                transform: translate(-5px, -5px);
                text-shadow: -2px -2px 0px rgba(0, 255, 0, 0.5), 2px 2px 0px rgba(0, 0, 255, 0.5);
            }
            100% {
                transform: translate(0);
                text-shadow: 2px 2px 0px rgba(255, 0, 0, 0.5), -2px -2px 0px rgba(0, 0, 255, 0.5);
            }
        }
    </style>
</head>
<body class="scanlines p-4 md:p-8">

    <!-- SVG Filters for that crunchy text look -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <filter id="distort-text">
                <feTurbulence type="fractalNoise" baseFrequency="0.02" numOctaves="1" result="warp" />
                <feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="2" in="SourceGraphic" in2="warp" />
            </filter>
        </defs>
    </svg>

    <!-- BOOT SCREEN (The fake loading sequence) -->
    <div id="boot-screen">
        <div id="boot-log" class="font-mono whitespace-pre-wrap leading-tight"></div>
    </div>

    <!-- MAIN INTERFACE -->
    <main id="main-interface" class="max-w-3xl mx-auto h-full flex flex-col opacity-0 transition-opacity duration-1000">
        
        <!-- HEADER -->
        <header class="mb-4 p-4 rounded-sm terminal-box flex justify-between items-start shrink-0">
            <div>
                <!-- ADDED glitch-anim CLASS FOR TITLE EFFECT -->
                <h1 class="glitch-title text-4xl md:text-5xl lg:text-6xl leading-none text-[var(--text-main)] glow-text glitch-anim">
                    POLARIS
                </h1>
                <div class="flex items-center gap-2 mt-2 text-xs font-bold tracking-widest text-[var(--text-muted)]">
                    <!-- Added subtle ping animation -->
                    <span class="w-2 h-2 rounded-full bg-[var(--accent-color)] animate-ping absolute"></span>
                    <span class="w-2 h-2 rounded-full bg-[var(--accent-color)] ml-1"></span>
                    SYSTEM ONLINE // GUIDANCE LOG
                </div>
            </div>
            
            <button onclick="toggleTheme()" class="p-2 border border-[var(--accent-dim)] hover:bg-[var(--accent-dim)] transition-colors rounded-sm hover:border-[var(--accent-color)]">
                <i id="theme-icon" data-lucide="moon" class="w-5 h-5 text-[var(--accent-color)]"></i>
            </button>
        </header>

        <!-- OUTPUT TERMINAL (Where the chat happens) -->
        <!-- Added a border glow for visual pop -->
        <div id="terminal-output" class="flex-grow terminal-box mb-4 p-4 rounded-sm overflow-y-auto font-mono text-sm leading-relaxed space-y-2 relative border-2 border-[var(--accent-dim)]">
            <!-- Content injected via JS -->
        </div>

        <!-- INPUT AREA -->
        <section class="mb-4 shrink-0">
            <!-- Added input-focus class for animated focus state -->
            <div class="flex items-center terminal-box p-3 rounded-sm border-l-4 border-l-[var(--accent-color)] input-focus">
                <label for="command-input" id="prompt-label" class="text-lg whitespace-nowrap pr-3 command-prompt glow-text">
                    POLARIS >
                </label>
                <input
                    type="text"
                    id="command-input"
                    class="w-full bg-transparent outline-none border-none font-mono text-lg text-[var(--text-main)] placeholder-[var(--accent-dim)]"
                    placeholder="ENTER COMMAND..."
                    autocomplete="off"
                    autofocus
                >
            </div>
            <div class="flex justify-between mt-1 text-[10px] text-[var(--text-muted)] uppercase tracking-wider px-1">
                <span>Type '!help' for protocols</span>
                <span id="sound-status">AUDIO: ON</span>
            </div>
        </section>

        <!-- DASHBOARD (The quick links) -->
        <section class="terminal-box p-4 rounded-sm shrink-0">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs">
                <!-- Links injected via JS -->
                <div id="links-container" class="col-span-2 md:col-span-3 grid grid-cols-2 md:grid-cols-3 gap-2"></div>
                
                <!-- Status Panel -->
                <div class="col-span-2 md:col-span-1 border-l border-[var(--accent-dim)] pl-4 flex flex-col justify-between opacity-70">
                    <div>
                        <div class="font-bold text-[var(--accent-color)] mb-1">OPERATOR</div>
                        <div>ZEP / ALCOR</div>
                    </div>
                    <div>
                        <div class="font-bold text-[var(--accent-color)] mb-1">CURRENT MOOD</div>
                        <div id="mood-status">VIBING</div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        /*
         * POLARIS SYSTEM CORE v4.3 (CORE IDENTITY SCAN)
         * "If it works, don't touch it. If it breaks, it's art (I'll cry)."
         */

        // --- CONSTANTS & DATA ---
        const USER_DATA = {
            name: "Sajid (aka Zep/Alcor)",
            role: "Content Editor / Certified Chaos Manager",
            // UPDATED DETAILS FOR NEW PERSONALITY
            details: "19 | He/Him | ENFJ | Muslim | Skadi-Obsessed | GMT+6 (BD)", 
            bio: `
                [LOG_ENTRY_01]: Greetings, Operator.

                I'm Sajidâ€”you can call me Alcor or Zep. 
            `,
            interests: {
                // UPDATED MUSIC LIST
                games: ["SMT / Persona (Existential dread simulator)", "Project Moon (The brainrot is real)", "Arknights (Skadi <3)", "HSR (Gambling addiction)", "Roblox (The true chaos realm)"],
                philosophy: ["Absurdism (Rolling the boulder)", "Jungian Psychology", "Gnosticism"],
                music: ["Jazz Rap (The smoothest chaos)", "Indie (Main character energy)", "Hip Hop (Lyrical fire)"]
            },
            links: [
                { label: "YOUTUBE", url: "https://youtube.com/@NahZD", type: "MEDIA" },
                { label: "TIKTOK", url: "https://tiktok.com/@alcor.zep", type: "MEDIA" },
                { label: "INSTAGRAM", url: "https://instagram.com/alcor.zep", type: "SOCIAL" },
                { label: "DISCORD (USER)", url: "https://discord.com/users/747419107040690196", type: "SOCIAL" },
                { label: "DISCORD (SERVER)", url: "https://discord.gg/W4mRvsaywB", type: "COMMUNITY" },
                { label: "SPOTIFY", url: "https://open.spotify.com/user/31ag2h6ylpngleeu6oefkpmql6km", type: "MEDIA" },
                { label: "STEAM", url: "https://steamcommunity.com/id/alcorzep", type: "GAMING" },
                { label: "ROBLOX", url: "https://www.roblox.com/users/SDEDIN", type: "GAMING" },
                // UPDATED GITHUB URL
                { label: "GITHUB (alcorzep)", url: "https://github.com/alcorzep", type: "CODE" }, 
            ]
        };

        // --- STATE MANAGEMENT ---
        const state = {
            // geminiMode: false, // REMOVED: No longer needed
            soundEnabled: true,
            isTyping: false
        };

        // --- DOM ELEMENTS ---
        const els = {
            output: document.getElementById('terminal-output'),
            input: document.getElementById('command-input'),
            boot: document.getElementById('boot-screen'),
            bootLog: document.getElementById('boot-log'),
            main: document.getElementById('main-interface'),
            links: document.getElementById('links-container'),
            prompt: document.getElementById('prompt-label'),
            soundStatus: document.getElementById('sound-status')
        };

        // --- AUDIO ENGINE (Tone.js) ---
        let synth;
        const initAudio = () => {
            try {
                synth = new Tone.MembraneSynth({
                    volume: -12,
                    envelope: { attack: 0.001, decay: 0.1, sustain: 0, release: 0.1 }
                }).toDestination();
            } catch (e) { console.log("Audio failed. Sad."); }
        };

        const playSound = (type = 'click') => {
            if (!state.soundEnabled || !synth) return;
            if (Tone.context.state !== 'running') Tone.context.resume();
            
            if (type === 'click') synth.triggerAttackRelease("C2", "32n");
            if (type === 'error') synth.triggerAttackRelease("G1", "16n");
            if (type === 'success') synth.triggerAttackRelease("C4", "16n");
        };

        // --- VISUAL FX: TYPEWRITER ---
        // This adds that sweet character-by-character rendering
        const typeWriter = (element, text, speed = 10) => {
            return new Promise(resolve => {
                state.isTyping = true;
                let i = 0;
                // Handle HTML tags roughly (skip them)
                const animate = () => {
                    if (i < text.length) {
                        // If we hit a tag, jump to end of tag
                        if (text[i] === '<') {
                            const end = text.indexOf('>', i);
                            element.innerHTML += text.substring(i, end + 1);
                            i = end + 1;
                        } else {
                            element.innerHTML += text.charAt(i);
                            i++;
                            // Randomize speed slightly for "human" feel
                            if (i % 3 === 0) playSound('click'); 
                        }
                        els.output.scrollTop = els.output.scrollHeight;
                        setTimeout(animate, speed);
                    } else {
                        state.isTyping = false;
                        resolve();
                    }
                };
                animate();
            });
        };

        // --- BOOT SEQUENCE ---
        const runBootSequence = async () => {
            // UPDATED BOOT SEQUENCE
            const lines = [
                "INITIALIZING POLARIS KERNEL v4.3...",
                "CHECKING MEMORY INTEGRITY... [OK]",
                "MOUNTING VIRTUAL FILE SYSTEM... [OK]",
                "LOADING PERSONALITY DRIVERS (ALCOR.SYS)...",
                " > CHAR_ID: SAJID/ALCOR",
                " > TRAITS: PROBABLY GLAZING SKADI", // Updated traits
                "CONNECTING TO GLOBAL NETWORK...",
                "ESTABLISHING SECURE CONNECTION...",
                "SYSTEM READY."
            ];

            for (const line of lines) {
                const p = document.createElement('div');
                p.textContent = line;
                els.bootLog.appendChild(p);
                // Faster boot sequence for better UX after initial load
                await new Promise(r => setTimeout(r, Math.random() * 50 + 50)); 
            }

            await new Promise(r => setTimeout(r, 800));
            
            // Fade out boot screen
            els.boot.style.opacity = '0';
            els.boot.style.pointerEvents = 'none';
            
            // Fade in main UI
            els.main.classList.remove('opacity-0');
            
            // Initial Welcome Message
            setTimeout(() => {
                printOutput(`
                    <div style="color:var(--accent-color)">Welcome, Operator.</div>
                    <div>System is online.
                    <div>Type <span class="command-prompt">!help</span> to start your guidance session.</div>
                `, false); // false = instant print for initial
            }, 500);
        };

        // --- OUTPUT HANDLER ---
        const printOutput = (html, useTyping = true) => {
            const div = document.createElement('div');
            // Added animation class for output rows
            div.className = "mb-4 border-b border-[var(--accent-dim)] pb-2 last:border-0 opacity-0 animate-fadeIn"; 
            els.output.appendChild(div);
            
            // Define the fade-in animation for each new line
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(5px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .animate-fadeIn {
                    animation: fadeIn 0.3s ease-out forwards;
                }
            `;
            document.head.appendChild(style);

            if (useTyping && !html.includes("<img") && !html.includes("<ul")) {
                // Only type plain-ish text blocks to avoid breaking complex HTML
                typeWriter(div, html);
            } else {
                div.innerHTML = html;
                div.classList.remove('opacity-0'); // Remove initial opacity if instant
                els.output.scrollTop = els.output.scrollHeight;
                playSound('success');
            }
        };

        const printPrompt = (cmd, type = 'user') => {
            const div = document.createElement('div');
            // Added animation class for prompt lines
            div.className = "mb-1 text-xs opacity-70 animate-fadeIn";
            const prefix = type === 'user' ? 'OPR' : 'SYS'; // Changed 'AI' to 'SYS'
            const color = type === 'user' ? 'var(--text-muted)' : 'var(--success-color)';
            div.innerHTML = `<span style="color:${color}">[${prefix}]:</span> ${cmd}`;
            els.output.appendChild(div);
            els.output.scrollTop = els.output.scrollHeight;
        };

        // --- COMMAND PROCESSOR ---
        const commands = {
            '!help': () => {
                return `
                    <span class="command-prompt">:: COMMAND INDEX ::</span><br>
                    <span class="text-[var(--accent-color)]">!bio</span>     - Load operator profile<br>
                    <span class="text-[var(--accent-color)]">!comms</span>   - List network endpoints (UPDATED)<br>
                    <span class="text-[var(--accent-color)]">!data</span>    - Access interests log<br>
                    <span class="text-[var(--accent-color)]">!track</span>   - Recommend a song<br>
                    <span class="text-[var(--accent-color)]">!calc</span>    - Execute math [ex: !calc 2+2]<br>
                    <span class="text-[var(--accent-color)]">!mute</span>    - Toggle audio system<br>
                    <span class="text-[var(--accent-color)]">!clear</span>   - Purge screen buffer<br>
                    <span class="text-[var(--accent-color)]">!ping</span>    - Get system status
                `;
            },
            '!bio': () => {
                // UPDATED BIO OUTPUT
                const personality = `
                    <span class="text-[var(--accent-color)]">Personality Subroutines:</span><br>
                    > Imagine me sayijg cool stuff. <br>
                    > I don't get paid enough for this.<br>
                   
                `;

                return `
                    <span class="command-prompt">:: OPERATOR PROFILE ::</span><br>
                    ${USER_DATA.bio.replace(/\n/g, '<br>')}<br><br>
                    <span class="text-xs border border-[var(--accent-dim)] p-1 block">
                        STATUS: ${USER_DATA.role} | ${USER_DATA.details}
                    </span>
                    <br>${personality.replace(/\n/g, '<br>')}
                `;
            },
            '!comms': () => {
                let html = `<span class="command-prompt">:: NETWORK ENDPOINTS ::</span><br><ul class="list-disc pl-4 mt-2">`;
                USER_DATA.links.forEach(l => {
                    html += `<li><a href="${l.url}" target="_blank" class="hover-link">${l.label}</a> <span class="text-[var(--text-muted)] text-xs">[${l.type}]</span></li>`;
                });
                return html + `</ul>`;
            },
            '!data': () => {
                let html = `<span class="command-prompt">:: INTERESTS LOG ::</span><br>`;
                for (const [key, items] of Object.entries(USER_DATA.interests)) {
                    html += `<br><span class="uppercase text-[var(--accent-color)]">[${key}]</span><br>`;
                    items.forEach(i => html += `> ${i}<br>`);
                }
                return html;
            },
            '!track': () => {
                const tracks = [
                    "Aruarian Dance - Nujabes (The smoothest chaos, no cap)", "Doomsday - MF DOOM", 
                    "Let It Happen - Tame Impala", "From The Start - Laufey (Don't tell anyone)", 
                    "Rhinestone Eyes - Gorillaz", "After Dark - Mr. Kitty (A true vibe.)"
                ];
                const pick = tracks[Math.floor(Math.random() * tracks.length)];
                return `
                    <span class="command-prompt">:: AUDIO RECOMMENDATION ::</span><br>
                    NOW PLAYING SIMULATION: <span style="color:var(--accent-color)">${pick}</span><br>
                    <span class="text-xs text-[var(--text-muted)]">(Imagine the music playing. It's a vibe, no cap.)</span>
                `;
            },
            '!mute': () => {
                state.soundEnabled = !state.soundEnabled;
                els.soundStatus.textContent = state.soundEnabled ? "AUDIO: ON" : "AUDIO: OFF";
                return `AUDIO SYSTEM: <span style="color:${state.soundEnabled ? 'var(--success-color)' : 'var(--error-color)'}">${state.soundEnabled ? 'ONLINE' : 'OFFLINE'}</span>`;
            },
            '!ping': () => {
                const status = USER_DATA.role.split(' / ')[1].split(' ')[0];
                return `
                    <span class="command-prompt">:: SYSTEM STATUS REPORT ::</span><br>
                    Core Identity: ALCOR.SYS<br>
                    Role: ${status}<br>
                    Time on GMT+6: ${(new Date()).toLocaleTimeString()}<br>
                    <span style="color:var(--success-color)">Latency: Stable. Everything is fine. Actualy.</span>
                `;
            }
        };

        const handleCommand = (raw) => {
            const input = raw.trim();
            const cmd = input.split(' ')[0].toLowerCase();
            const args = input.substring(cmd.length).trim();

            if (!input) return;

            // The main control flow is now simple command processing
            printPrompt(input, 'user');

            if (cmd === '!clear') {
                els.output.innerHTML = '';
                playSound('success');
                return;
            }
            
            // REMOVED: !gemini, !exit logic

            if (cmd === '!calc') {
                try {
                    // Safe eval for basic math
                    const res = Function('"use strict";return (' + args + ')')();
                    printOutput(`CALCULATED RESULT: <span class="text-xl text-[var(--accent-color)]">${res}</span>`);
                } catch {
                    printOutput(`<span style="color:var(--error-color)">ERROR: INVALID MATHEMATICAL SYNTAX.</span>`);
                    playSound('error');
                }
                return;
            }

            if (commands[cmd]) {
                printOutput(commands[cmd]());
            } else {
                // Custom response for unknown command
                printOutput(`
                    <span style="color:var(--error-color)">[ERR]: UNKNOWN PROTOCOL '${cmd}'.</span>
                    <div>I see you trying to explore the mainframe. Smart. But I'm too cunning for that. Try <span class="command-prompt">!help</span>, no cap.</div>
                `);
                playSound('error');
            }
        };

        // --- EVENTS ---
        els.input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (state.isTyping) return; // Prevent new command while output is typing
                handleCommand(els.input.value);
                els.input.value = '';
            } else {
                playSound('click'); // Typing sound
            }
        });
        
        // Skip boot sequence on click/tap
        els.boot.addEventListener('click', () => {
            if (els.boot.style.opacity !== '0') {
                els.boot.style.opacity = '0';
                els.boot.style.pointerEvents = 'none';
                els.main.classList.remove('opacity-0');
                // Ensure the initial message is displayed if the sequence was skipped
                if (els.output.children.length === 0) {
                     printOutput(`
                        <div style="color:var(--accent-color)">Welcome, Operator. (Boot sequence skipped)</div>
                        <div>System is online. The cat is vibing.</div>
                        <div>Type <span class="command-prompt">!help</span> to start your guidance session.</div>
                    `, false);
                }
            }
        });


        // Dashboard Link Renderer
        const initDashboard = () => {
            let html = '';
            USER_DATA.links.forEach(link => {
                html += `
                    <a href="${link.url}" target="_blank" class="block p-2 border border-[var(--glass-bg)] hover:border-[var(--accent-color)] hover:bg-[var(--glass-bg)] transition-all group hover:shadow-lg hover:shadow-[rgba(220,191,166,0.2)]">
                        <div class="font-bold text-[var(--accent-color)] group-hover:translate-x-1 transition-transform">
                            ${link.label}
                        </div>
                        <div class="text-[10px] text-[var(--text-muted)]">${link.type}</div>
                    </a>
                `;
            });
            els.links.innerHTML = html;
        };

        // Theme Toggle
        window.toggleTheme = () => {
            document.body.classList.toggle('light-mode');
            const icon = document.getElementById('theme-icon');
            if (document.body.classList.contains('light-mode')) {
                icon.setAttribute('data-lucide', 'sun');
            } else {
                icon.setAttribute('data-lucide', 'moon');
            }
            lucide.createIcons();
            playSound('click');
        };

        // --- INIT ---
        window.onload = () => {
            initAudio();
            initDashboard();
            lucide.createIcons();
            runBootSequence();
            
            // Focus input on click anywhere
            document.addEventListener('click', (e) => {
                // Only focus if the user isn't selecting text or clicking a link/button
                const isInteractive = e.target.closest('a, button, input');
                if (!window.getSelection().toString() && !isInteractive) {
                    els.input.focus();
                }
            });
        };

    </script>
</body>
</html>
